<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CLOSERS | –ü–æ–∏—Å–∫ –∏ –∑–∞–∫–∞–∑ —Å POIZON</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
        }
        
        /* ========== –¢–ï–ú–ù–ê–Ø –¢–ï–ú–ê ========== */
        body {
            background-color: #1a1a1a;
            color: #ffffff;
            padding: 0 12px 80px 12px;
        }
        
        .app {
            max-width: 600px;
            margin: 0 auto;
        }
        
        /* ========== –•–ï–î–ï–† ========== */
        .header {
            text-align: center;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 1px solid #333333;
        }
        
        .header h1 {
            font-size: 36px;
            font-weight: 700;
            letter-spacing: 1px;
            color: #ffffff;
            margin-bottom: 4px;
        }
        
        .subtitle {
            color: #999999;
            font-size: 14px;
            font-weight: 400;
            text-transform: uppercase;
            letter-spacing: 2px;
        }
        
        /* ========== –£–í–ï–î–û–ú–õ–ï–ù–ò–ï –û VPN ========== */
        .vpn-notification {
            background-color: #2a2a2a;
            border-left: 4px solid #ffffff;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 20px;
            border: 1px solid #3a3a3a;
        }
        
        .vpn-content {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .vpn-icon {
            width: 40px;
            height: 40px;
            background-color: #ffffff;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #1a1a1a;
            font-size: 20px;
        }
        
        .vpn-text {
            flex: 1;
            font-size: 13px;
            color: #cccccc;
            line-height: 1.4;
        }
        
        .vpn-text strong {
            color: #ffffff;
            display: block;
            margin-bottom: 4px;
        }
        
        .vpn-close {
            background: none;
            border: none;
            color: #999;
            font-size: 20px;
            cursor: pointer;
            padding: 0 4px;
        }
        
        /* ========== –ù–ò–ñ–ù–ï–ï –ú–ï–ù–Æ ========== */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: #1a1a1a;
            border-top: 1px solid #333333;
            display: flex;
            justify-content: space-around;
            padding: 8px 16px 20px 16px;
            max-width: 600px;
            margin: 0 auto;
            z-index: 100;
        }
        
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            background: none;
            border: none;
            font-size: 11px;
            color: #999999;
            cursor: pointer;
            padding: 4px 8px;
            border-radius: 8px;
            gap: 4px;
        }
        
        .nav-item.active {
            color: #ffffff;
            font-weight: 500;
        }
        
        .nav-icon {
            font-size: 22px;
        }
        
        #cart-badge {
            background-color: #ffffff;
            color: #1a1a1a;
            border-radius: 20px;
            padding: 2px 6px;
            font-size: 10px;
            margin-left: 2px;
            font-weight: 600;
        }
        
        /* ========== –ö–ê–¢–ê–õ–û–ì (3 –ö–û–õ–û–ù–ö–ò) ========== */
        .section-title {
            font-size: 18px;
            font-weight: 600;
            margin: 20px 0 12px 0;
            color: #ffffff;
        }
        
        .catalog-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-bottom: 24px;
        }
        
        .product-card {
            background-color: #2a2a2a;
            border-radius: 12px;
            padding: 8px;
            cursor: pointer;
            transition: all 0.2s;
            border: 1px solid #3a3a3a;
            position: relative;
        }
        
        .product-card:hover {
            transform: translateY(-2px);
            border-color: #ffffff;
        }
        
        .product-card.in-cart {
            border-color: #ffffff;
            background-color: #333333;
        }
        
        .product-image {
            width: 100%;
            aspect-ratio: 1/1;
            background-color: #3a3a3a;
            border-radius: 8px;
            margin-bottom: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #999999;
            font-size: 10px;
            font-weight: 500;
        }
        
        .product-title {
            font-size: 11px;
            font-weight: 500;
            margin-bottom: 2px;
            line-height: 1.2;
            height: 26px;
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            color: #ffffff;
        }
        
        .product-price {
            font-size: 12px;
            font-weight: 600;
            color: #ffffff;
        }
        
        .cart-badge-mini {
            position: absolute;
            top: 4px;
            right: 4px;
            background-color: #ffffff;
            color: #1a1a1a;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            font-size: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        
        /* ========== –†–ê–ó–î–ï–õ–ò–¢–ï–õ–¨ ========== */
        .divider {
            display: flex;
            align-items: center;
            text-align: center;
            margin: 24px 0;
            color: #999999;
            font-size: 12px;
        }
        
        .divider::before,
        .divider::after {
            content: '';
            flex: 1;
            border-bottom: 1px solid #333333;
        }
        
        .divider::before {
            margin-right: 12px;
        }
        
        .divider::after {
            margin-left: 12px;
        }
        
        /* ========== FAQ ========== */
        .faq-section {
            background-color: #2a2a2a;
            border-radius: 16px;
            padding: 20px;
            margin-top: 16px;
            border: 1px solid #3a3a3a;
        }
        
        .faq-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 16px;
            color: #ffffff;
        }
        
        .faq-item {
            margin-bottom: 16px;
            border-bottom: 1px solid #3a3a3a;
            padding-bottom: 16px;
        }
        
        .faq-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        
        .faq-question {
            font-weight: 600;
            font-size: 15px;
            margin-bottom: 8px;
            color: #ffffff;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .faq-question span {
            font-size: 18px;
        }
        
        .faq-answer {
            font-size: 14px;
            color: #cccccc;
            line-height: 1.5;
            padding-left: 26px;
        }
        
        /* ========== –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û ========== */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0,0,0,0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 16px;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background-color: #2a2a2a;
            border-radius: 20px;
            padding: 20px;
            width: 100%;
            max-width: 400px;
            max-height: 80vh;
            overflow-y: auto;
            border: 1px solid #3a3a3a;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }
        
        .modal-title {
            font-size: 18px;
            font-weight: 600;
            color: #ffffff;
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #999999;
        }
        
        .modal-product-preview {
            margin-bottom: 16px;
            padding: 12px;
            background-color: #1a1a1a;
            border-radius: 12px;
        }
        
        .modal-product-name {
            font-weight: 600;
            margin-bottom: 4px;
            color: #ffffff;
        }
        
        .modal-product-price {
            color: #999999;
            font-size: 14px;
        }
        
        /* ========== –§–û–†–ú–´ ========== */
        .form-group {
            margin-bottom: 16px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-size: 12px;
            font-weight: 500;
            color: #999999;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #3a3a3a;
            border-radius: 8px;
            background-color: #1a1a1a;
            color: #ffffff;
            font-size: 14px;
        }
        
        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #ffffff;
        }
        
        .form-group input::placeholder,
        .form-group textarea::placeholder {
            color: #666666;
        }
        
        select option {
            background-color: #1a1a1a;
            color: #ffffff;
        }
        
        /* ========== –ó–ê–ì–†–£–ó–ö–ê –§–û–¢–û ========== */
        .photo-upload-area {
            border: 1px dashed #3a3a3a;
            border-radius: 12px;
            padding: 16px;
            text-align: center;
            margin-bottom: 12px;
            cursor: pointer;
            background-color: #1a1a1a;
        }
        
        .photo-upload-area:hover {
            border-color: #ffffff;
        }
        
        .photo-preview-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 8px;
            margin: 12px 0;
        }
        
        .photo-preview-item {
            position: relative;
            aspect-ratio: 1/1;
            border-radius: 8px;
            overflow: hidden;
            border: 1px solid #3a3a3a;
        }
        
        .photo-preview-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .photo-remove {
            position: absolute;
            top: 2px;
            right: 2px;
            background-color: rgba(0,0,0,0.7);
            color: white;
            border: none;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }
        
        /* ========== –°–í–û–ë–û–î–ù–´–ô –ó–ê–ü–†–û–° ========== */
        .free-request-section {
            background-color: #2a2a2a;
            border-radius: 16px;
            padding: 20px;
            margin-top: 16px;
            border: 1px solid #3a3a3a;
        }
        
        .free-request-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 16px;
            color: #ffffff;
        }
        
        .free-request-hint {
            font-size: 13px;
            color: #cccccc;
            margin-bottom: 20px;
            padding: 12px;
            background-color: #1a1a1a;
            border-radius: 8px;
        }
        
        /* ========== –ö–û–†–ó–ò–ù–ê ========== */
        .cart-container {
            background-color: #2a2a2a;
            border-radius: 16px;
            padding: 16px;
            margin-bottom: 16px;
            border: 1px solid #3a3a3a;
        }
        
        .cart-item {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            padding: 12px;
            background-color: #1a1a1a;
            border-radius: 12px;
            margin-bottom: 8px;
            border: 1px solid #3a3a3a;
        }
        
        .cart-item-info {
            flex: 1;
        }
        
        .cart-item-title {
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 4px;
            color: #ffffff;
        }
        
        .cart-item-details {
            font-size: 12px;
            color: #cccccc;
            white-space: pre-line;
        }
        
        .cart-item-badge {
            display: inline-block;
            padding: 2px 8px;
            background-color: #2a2a2a;
            border-radius: 12px;
            font-size: 10px;
            margin-bottom: 4px;
            color: #999999;
        }
        
        .cart-item-remove {
            background: none;
            border: none;
            color: #666666;
            font-size: 18px;
            cursor: pointer;
        }
        
        /* ========== –ö–ù–û–ü–ö–ò ========== */
        .btn {
            width: 100%;
            padding: 16px;
            background-color: #ffffff;
            color: #1a1a1a;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin-bottom: 8px;
            transition: all 0.2s;
        }
        
        .btn:hover {
            background-color: #e0e0e0;
        }
        
        .btn-secondary {
            background-color: #2a2a2a;
            color: #ffffff;
            border: 1px solid #3a3a3a;
        }
        
        .btn-secondary:hover {
            background-color: #333333;
        }
        
        .cart-summary {
            padding: 20px;
            background-color: #1a1a1a;
            border-radius: 12px;
            margin: 20px 0;
            border: 1px solid #3a3a3a;
            text-align: center;
        }
        
        .cart-summary p {
            font-size: 18px;
            font-weight: 600;
            color: #ffffff;
        }
        
        /* ========== –ó–ê–ö–ê–ó–´ ========== */
        .orders-list {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }
        
        .order-card {
            background-color: #2a2a2a;
            border-radius: 16px;
            padding: 16px;
            border: 1px solid #3a3a3a;
        }
        
        .order-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .order-id {
            font-weight: 700;
            font-size: 15px;
            color: #ffffff;
        }
        
        .order-status-badge {
            padding: 4px 8px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 500;
            background-color: #1a1a1a;
            color: #cccccc;
        }
        
        .status-timeline {
            margin: 16px 0;
        }
        
        .status-step {
            display: flex;
            align-items: flex-start;
            margin-bottom: 12px;
            position: relative;
        }
        
        .status-dot {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background-color: #3a3a3a;
            margin-right: 12px;
            flex-shrink: 0;
            position: relative;
            z-index: 2;
        }
        
        .status-dot.completed {
            background-color: #ffffff;
        }
        
        .status-dot.active {
            background-color: #ffffff;
            box-shadow: 0 0 0 3px rgba(255,255,255,0.2);
        }
        
        .status-line {
            position: absolute;
            left: 9px;
            top: 20px;
            width: 2px;
            height: calc(100% - 8px);
            background-color: #3a3a3a;
            z-index: 1;
        }
        
        .status-content {
            flex: 1;
            padding-bottom: 12px;
        }
        
        .status-title {
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 2px;
            color: #ffffff;
        }
        
        .status-date {
            font-size: 11px;
            color: #999999;
        }
        
        .support-link {
            display: inline-block;
            padding: 8px 16px;
            background-color: #ffffff;
            color: #1a1a1a;
            text-decoration: none;
            border-radius: 30px;
            font-size: 13px;
            font-weight: 500;
        }
        
        .loading {
            text-align: center;
            color: #999999;
            padding: 40px;
        }
    </style>
</head>
<body>
    <div class="app">
        <!-- –•–ï–î–ï–† -->
        <header class="header">
            <h1>CLOSERS</h1>
            <div class="subtitle">–ü–û–ò–°–ö –ò –ó–ê–ö–ê–ó –° POIZON</div>
        </header>

        <!-- –£–í–ï–î–û–ú–õ–ï–ù–ò–ï –û VPN -->
        <div id="vpn-notification" class="vpn-notification">
            <div class="vpn-content">
                <div class="vpn-icon">üõ°Ô∏è</div>
                <div class="vpn-text">
                    <strong>–î–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã</strong>
                    –ï—Å–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –≤–∫–ª—é—á–∏—Ç—å VPN. –≠—Ç–æ —Å–≤—è–∑–∞–Ω–æ —Å –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—è–º–∏ —Ä–∞–±–æ—Ç—ã –≤ –≤–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ.
                </div>
                <button class="vpn-close" onclick="this.parentElement.parentElement.style.display='none'">√ó</button>
            </div>
        </div>

        <!-- –ö–ê–¢–ê–õ–û–ì (–æ—Å–Ω–æ–≤–Ω–∞—è –≤–∫–ª–∞–¥–∫–∞) -->
        <div id="catalog-view">
            <!-- –ö–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤ -->
            <div class="section-title">–ü–æ–ø—É–ª—è—Ä–Ω–æ–µ</div>
            <div class="catalog-grid" id="catalog-grid"></div>
            
            <!-- –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å -->
            <div class="divider">–ò–õ–ò</div>
            
            <!-- –°–≤–æ–±–æ–¥–Ω—ã–π –∑–∞–ø—Ä–æ—Å -->
            <div class="free-request-section">
                <div class="free-request-title">–ù–µ –Ω–∞—à–ª–∏ –Ω—É–∂–Ω—É—é –≤–µ—â—å?</div>
                <div class="free-request-hint">
                    –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Å–≤–æ–π –∑–∞–ø—Ä–æ—Å ‚Äî –º—ã –Ω–∞–π–¥–µ–º –∏ –ø—Ä–∏–≤–µ–∑–µ–º –ª—é–±–æ–π —Ç–æ–≤–∞—Ä —Å POIZON
                </div>
                
                <div class="form-group">
                    <label>–ß–¢–û –ò–©–ï–¢–ï? *</label>
                    <input type="text" id="free-query" placeholder="–°—Å—ã–ª–∫–∞, –∞—Ä—Ç–∏–∫—É–ª –∏–ª–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞">
                </div>
                
                <div class="form-group">
                    <label>–†–ê–ó–ú–ï–† (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
                    <select id="free-size">
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–∑–º–µ—Ä</option>
                        <option value="XS">XS</option>
                        <option value="S">S</option>
                        <option value="M">M</option>
                        <option value="L">L</option>
                        <option value="XL">XL</option>
                        <option value="XXL">XXL</option>
                        <option value="36">36 EU</option>
                        <option value="37">37 EU</option>
                        <option value="38">38 EU</option>
                        <option value="39">39 EU</option>
                        <option value="40">40 EU</option>
                        <option value="41">41 EU</option>
                        <option value="42">42 EU</option>
                        <option value="43">43 EU</option>
                        <option value="44">44 EU</option>
                        <option value="45">45 EU</option>
                        <option value="46">46 EU</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>–¶–í–ï–¢ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
                    <input type="text" id="free-color" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: Black/White">
                </div>
                
                <div class="form-group">
                    <label>–ü–û–ñ–ï–õ–ê–ù–ò–Ø (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
                    <textarea id="free-notes" rows="2" placeholder="–û—Å–æ–±—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è, —Å–æ—Å—Ç–æ—è–Ω–∏–µ, –±—é–¥–∂–µ—Ç..."></textarea>
                </div>
                
                <!-- –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ -->
                <div class="form-group">
                    <label>–§–û–¢–û (–¥–æ 5 —à—Ç, –Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
                    <div class="photo-upload-area" onclick="document.getElementById('free-file-input').click()">
                        <span style="font-size: 24px;">üì∑</span>
                        <div style="font-size: 12px; color: #999;">–ù–∞–∂–º–∏—Ç–µ, —á—Ç–æ–±—ã –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ</div>
                    </div>
                    <input type="file" id="free-file-input" accept="image/*" multiple style="display: none;" onchange="handleFreePhotos(event)">
                    <div id="free-photo-preview" class="photo-preview-grid"></div>
                </div>
                
                <button class="btn btn-secondary" onclick="addFreeRequest()">‚ûï –î–û–ë–ê–í–ò–¢–¨ –ó–ê–ü–†–û–°</button>
            </div>
        </div>
        
        <!-- –ö–û–†–ó–ò–ù–ê -->
        <div id="cart-view" style="display: none;">
            <div class="cart-container">
                <div class="section-title">–ö–æ—Ä–∑–∏–Ω–∞</div>
                <div id="cart-items"></div>
                <div id="cart-summary" class="cart-summary" style="display: none;">
                    <p><span id="cart-total">0</span> –¢–û–í–ê–†–û–í</p>
                </div>
                <button class="btn" onclick="submitOrder()" id="submit-order-btn">–û–§–û–†–ú–ò–¢–¨ –ó–ê–ö–ê–ó</button>
            </div>
        </div>
        
        <!-- –ó–ê–ö–ê–ó–´ -->
        <div id="orders-view" style="display: none;">
            <div class="section-title">–ú–æ–∏ –∑–∞–∫–∞–∑—ã</div>
            <div id="orders-list" class="orders-list"></div>
        </div>
        
        <!-- FAQ (–ù–û–í–ê–Ø –í–ö–õ–ê–î–ö–ê) -->
        <div id="faq-view" style="display: none;">
            <div class="faq-section">
                <div class="faq-title">–ß–∞—Å—Ç–æ –∑–∞–¥–∞–≤–∞–µ–º—ã–µ –≤–æ–ø—Ä–æ—Å—ã</div>
                
                <div class="faq-item">
                    <div class="faq-question">
                        <span>‚è±Ô∏è</span> –°–∫–æ–ª—å–∫–æ –∂–¥–∞—Ç—å –¥–æ—Å—Ç–∞–≤–∫—É?
                    </div>
                    <div class="faq-answer">
                        –û–±—ã—á–Ω–æ –¥–æ—Å—Ç–∞–≤–∫–∞ –∑–∞–Ω–∏–º–∞–µ—Ç –¥–æ 5 –¥–Ω–µ–π —Å –º–æ–º–µ–Ω—Ç–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞. –¢–æ—á–Ω—ã–µ —Å—Ä–æ–∫–∏ –∑–∞–≤–∏—Å—è—Ç –æ—Ç –Ω–∞–ª–∏—á–∏—è —Ç–æ–≤–∞—Ä–∞ –Ω–∞ POIZON –∏ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Å–ø–æ—Å–æ–±–∞ –¥–æ—Å—Ç–∞–≤–∫–∏.
                    </div>
                </div>
                
                <div class="faq-item">
                    <div class="faq-question">
                        <span>üí∞</span> –ö–∞–∫ —É–∑–Ω–∞—Ç—å —Ü–µ–Ω—É?
                    </div>
                    <div class="faq-answer">
                        –ü–æ—Å–ª–µ —Ç–æ–≥–æ –∫–∞–∫ –≤—ã –æ—Ñ–æ—Ä–º–∏—Ç–µ –∑–∞–∫–∞–∑, –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –ø—Ä–æ–≤–µ—Ä–∏—Ç –∞–∫—Ç—É–∞–ª—å–Ω—É—é —Ü–µ–Ω—É –Ω–∞ POIZON, –¥–æ–±–∞–≤–∏—Ç –∫–æ–º–∏—Å—Å–∏—é –º–∞–≥–∞–∑–∏–Ω–∞ –∏ —Å—Ç–æ–∏–º–æ—Å—Ç—å –¥–æ—Å—Ç–∞–≤–∫–∏. –ò—Ç–æ–≥–æ–≤–∞—è —Ü–µ–Ω–∞ –ø—Ä–∏–¥–µ—Ç –≤–∞–º –≤ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–∏.
                    </div>
                </div>
                
                <div class="faq-item">
                    <div class="faq-question">
                        <span>üîÑ</span> –ú–æ–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å —Ç–æ–≤–∞—Ä?
                    </div>
                    <div class="faq-answer">
                        –í–æ–∑–≤—Ä–∞—Ç –≤–æ–∑–º–æ–∂–µ–Ω —Ç–æ–ª—å–∫–æ –≤ —Å–ª—É—á–∞–µ –±—Ä–∞–∫–∞. –ú—ã —Ç—â–∞—Ç–µ–ª—å–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–µ–º –≤—Å–µ —Ç–æ–≤–∞—Ä—ã –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π, –Ω–æ –µ—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–ª–∞ –ø—Ä–æ–±–ª–µ–º–∞ ‚Äî –Ω–∞–ø–∏—à–∏—Ç–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É, –∏ –º—ã —Ä–µ—à–∏–º –≤–æ–ø—Ä–æ—Å.
                    </div>
                </div>
                
                <div class="faq-item">
                    <div class="faq-question">
                        <span>üì¶</span> –û—Ç–∫—É–¥–∞ –≤—ã –ø—Ä–∏–≤–æ–∑–∏—Ç–µ?
                    </div>
                    <div class="faq-answer">
                        –ú—ã –∑–∞–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–≤–∞—Ä—ã —Å –ø–ª–æ—â–∞–¥–∫–∏ POIZON ‚Äî —ç—Ç–æ –∫—Ä—É–ø–Ω–µ–π—à–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ —Å –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–º–∏ –≤–µ—â–∞–º–∏ –∏–∑ –ö–∏—Ç–∞—è, –Ø–ø–æ–Ω–∏–∏, –ö–æ—Ä–µ–∏ –∏ –°–®–ê.
                    </div>
                </div>
                
                <div class="faq-item">
                    <div class="faq-question">
                        <span>üîç</span> –ß—Ç–æ –¥–µ–ª–∞—Ç—å, –µ—Å–ª–∏ –Ω–µ –Ω–∞—à–µ–ª –≤–µ—â—å –≤ –∫–∞—Ç–∞–ª–æ–≥–µ?
                    </div>
                    <div class="faq-answer">
                        –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ–æ—Ä–º—É "–°–≤–æ–±–æ–¥–Ω—ã–π –∑–∞–ø—Ä–æ—Å" ‚Äî –ø—Ä–æ—Å—Ç–æ –≤—Å—Ç–∞–≤—å—Ç–µ —Å—Å—ã–ª–∫—É —Å POIZON, –∞—Ä—Ç–∏–∫—É–ª –∏–ª–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ, –∏ –º—ã –Ω–∞–π–¥–µ–º –Ω—É–∂–Ω—ã–π —Ç–æ–≤–∞—Ä.
                    </div>
                </div>
                
                <div class="support-contact" style="margin-top: 20px; text-align: center;">
                    <p style="color: #999999; margin-bottom: 10px;">–û—Å—Ç–∞–ª–∏—Å—å –≤–æ–ø—Ä–æ—Å—ã?</p>
                    <a href="https://t.me/closersmanager" class="support-link" target="_blank">–ù–ê–ü–ò–°–ê–¢–¨ –ê–î–ú–ò–ù–£</a>
                </div>
            </div>
        </div>
        
        <!-- –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û –î–õ–Ø –¢–û–í–ê–†–ê –ò–ó –ö–ê–¢–ê–õ–û–ì–ê -->
        <div id="product-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title">–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É</div>
                    <button class="modal-close" onclick="closeModal()">√ó</button>
                </div>
                
                <div id="modal-product" class="modal-product-preview"></div>
                
                <div class="form-group">
                    <label>–†–ê–ó–ú–ï–† (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
                    <select id="modal-size">
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–∑–º–µ—Ä</option>
                        <option value="XS">XS</option>
                        <option value="S">S</option>
                        <option value="M">M</option>
                        <option value="L">L</option>
                        <option value="XL">XL</option>
                        <option value="XXL">XXL</option>
                        <option value="36">36 EU</option>
                        <option value="37">37 EU</option>
                        <option value="38">38 EU</option>
                        <option value="39">39 EU</option>
                        <option value="40">40 EU</option>
                        <option value="41">41 EU</option>
                        <option value="42">42 EU</option>
                        <option value="43">43 EU</option>
                        <option value="44">44 EU</option>
                        <option value="45">45 EU</option>
                        <option value="46">46 EU</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>–¶–í–ï–¢ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
                    <input type="text" id="modal-color" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: Black/White">
                </div>
                
                <div class="form-group">
                    <label>–ü–û–ñ–ï–õ–ê–ù–ò–Ø (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
                    <textarea id="modal-notes" rows="2" placeholder="–û—Å–æ–±—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è..."></textarea>
                </div>
                
                <button class="btn" onclick="addToCartFromModal()">–î–û–ë–ê–í–ò–¢–¨ –í –ö–û–†–ó–ò–ù–£</button>
            </div>
        </div>
        
        <!-- –ù–ò–ñ–ù–ï–ï –ú–ï–ù–Æ (–¢–ï–ü–ï–†–¨ 4 –ö–ù–û–ü–ö–ò) -->
        <div class="bottom-nav">
            <button class="nav-item active" onclick="showView('catalog')">
                <span class="nav-icon">üõçÔ∏è</span>
                <span>–ö–∞—Ç–∞–ª–æ–≥</span>
            </button>
            <button class="nav-item" onclick="showView('cart')">
                <span class="nav-icon">üõí</span>
                <span>–ö–æ—Ä–∑–∏–Ω–∞ <span id="cart-badge">0</span></span>
            </button>
            <button class="nav-item" onclick="showView('orders')">
                <span class="nav-icon">üì¶</span>
                <span>–ó–∞–∫–∞–∑—ã</span>
            </button>
            <button class="nav-item" onclick="showView('faq')">
                <span class="nav-icon">‚ùì</span>
                <span>FAQ</span>
            </button>
        </div>
    </div>

    <script>
        let tg = window.Telegram.WebApp;
        tg.expand();
        
        let user = tg.initDataUnsafe?.user || { 
            id: Math.floor(Math.random() * 1000000), 
            first_name: '–ì–æ—Å—Ç—å',
            username: 'guest'
        };

        const API_URL = 'https://maxkom.pythonanywhere.com/api';
        const ADMIN_CONTACT = 'https://t.me/closersmanager';

        // ========== –ö–ê–¢–ê–õ–û–ì ==========
        const CATALOG = [
            { id: 1, name: 'Nike Air Jordan 1 High OG', price: '195$', image: 'AJ1' },
            { id: 2, name: 'Essentials Fear of God Hoodie', price: '110$', image: 'FOG' },
            { id: 3, name: 'Stussy 8 Ball Zip Hoodie', price: '145$', image: 'STUSSY' },
            { id: 4, name: 'New Balance 990v6 Grey', price: '200$', image: 'NB990' },
            { id: 5, name: 'Adidas Samba OG', price: '100$', image: 'SAMBA' },
            { id: 6, name: 'Supreme Box Logo Hoodie', price: '398$', image: 'SUPREME' }
        ];

        // ========== –ö–û–†–ó–ò–ù–ê ==========
        let cart = JSON.parse(localStorage.getItem('cart')) || [];
        let freePhotos = [];
        let currentModalProduct = null;
        let lastOrderTime = 0;
        const SPAM_DELAY = 30000;

        // ========== –û–¢–û–ë–†–ê–ñ–ï–ù–ò–ï –ö–ê–¢–ê–õ–û–ì–ê ==========
        function renderCatalog() {
            let html = '';
            CATALOG.forEach(product => {
                const inCart = cart.some(item => item.catalogId === product.id);
                const cartCount = cart.filter(item => item.catalogId === product.id).length;
                
                html += `
                    <div class="product-card ${inCart ? 'in-cart' : ''}" onclick="openProductModal(${product.id})">
                        <div class="product-image">${product.image}</div>
                        <div class="product-title">${product.name}</div>
                        <div class="product-price">${product.price}</div>
                        ${cartCount > 0 ? `<div class="cart-badge-mini">${cartCount}</div>` : ''}
                    </div>
                `;
            });
            document.getElementById('catalog-grid').innerHTML = html;
        }

        // ========== –ú–û–î–ê–õ–ö–ê –î–õ–Ø –¢–û–í–ê–†–ê –ò–ó –ö–ê–¢–ê–õ–û–ì–ê ==========
        window.openProductModal = function(productId) {
            const product = CATALOG.find(p => p.id === productId);
            if (!product) return;
            
            currentModalProduct = product;
            
            document.getElementById('modal-product').innerHTML = `
                <div class="modal-product-name">${product.name}</div>
                <div class="modal-product-price">${product.price}</div>
            `;
            
            document.getElementById('modal-size').value = '';
            document.getElementById('modal-color').value = '';
            document.getElementById('modal-notes').value = '';
            
            document.getElementById('product-modal').classList.add('active');
        };

        window.closeModal = function() {
            document.getElementById('product-modal').classList.remove('active');
            currentModalProduct = null;
        };

        // ========== –î–û–ë–ê–í–õ–ï–ù–ò–ï –ò–ó –ö–ê–¢–ê–õ–û–ì–ê ==========
        window.addToCartFromModal = function() {
            if (!currentModalProduct) return;
            
            const size = document.getElementById('modal-size').value;
            const color = document.getElementById('modal-color').value;
            const notes = document.getElementById('modal-notes').value;
            
            cart.push({
                catalogId: currentModalProduct.id,
                type: 'catalog',
                name: currentModalProduct.name,
                price: currentModalProduct.price,
                size: size,
                color: color,
                notes: notes,
                addedAt: new Date().toISOString()
            });
            
            localStorage.setItem('cart', JSON.stringify(cart));
            renderCatalog();
            updateCartBadge();
            closeModal();
            tg.showAlert(`‚úÖ –¢–æ–≤–∞—Ä –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∫–æ—Ä–∑–∏–Ω—É`);
        };

        // ========== –ó–ê–ì–†–£–ó–ö–ê –§–û–¢–û ==========
        window.handleFreePhotos = function(event) {
            const files = Array.from(event.target.files);
            if (freePhotos.length + files.length > 5) {
                tg.showAlert('–ú–æ–∂–Ω–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å –Ω–µ –±–æ–ª–µ–µ 5 —Ñ–æ—Ç–æ');
                return;
            }
            
            files.forEach(file => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    freePhotos.push(e.target.result);
                    renderFreePhotoPreview();
                };
                reader.readAsDataURL(file);
            });
        };

        function renderFreePhotoPreview() {
            let html = '';
            freePhotos.forEach((photo, index) => {
                html += `
                    <div class="photo-preview-item">
                        <img src="${photo}" alt="preview">
                        <button class="photo-remove" onclick="removeFreePhoto(${index})">√ó</button>
                    </div>
                `;
            });
            document.getElementById('free-photo-preview').innerHTML = html;
        }

        window.removeFreePhoto = function(index) {
            freePhotos.splice(index, 1);
            renderFreePhotoPreview();
        };

        // ========== –î–û–ë–ê–í–õ–ï–ù–ò–ï –°–í–û–ë–û–î–ù–û–ì–û –ó–ê–ü–†–û–°–ê ==========
        window.addFreeRequest = function() {
            const query = document.getElementById('free-query').value;
            const size = document.getElementById('free-size').value;
            const color = document.getElementById('free-color').value;
            const notes = document.getElementById('free-notes').value;
            
            if (!query) {
                tg.showAlert('–í–≤–µ–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å');
                return;
            }
            
            cart.push({
                type: 'free',
                name: '–ó–∞–ø—Ä–æ—Å: ' + query.substring(0, 30),
                query: query,
                size: size,
                color: color,
                notes: notes,
                photos: freePhotos.slice(),
                addedAt: new Date().toISOString()
            });
            
            localStorage.setItem('cart', JSON.stringify(cart));
            
            // –û—á–∏—â–∞–µ–º –ø–æ–ª—è
            document.getElementById('free-query').value = '';
            document.getElementById('free-size').value = '';
            document.getElementById('free-color').value = '';
            document.getElementById('free-notes').value = '';
            freePhotos = [];
            renderFreePhotoPreview();
            
            updateCartBadge();
            tg.showAlert(`‚úÖ –ó–∞–ø—Ä–æ—Å –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∫–æ—Ä–∑–∏–Ω—É`);
        };

        // ========== –ö–û–†–ó–ò–ù–ê ==========
        function renderCart() {
            if (cart.length === 0) {
                document.getElementById('cart-items').innerHTML = '<div style="text-align: center; padding: 40px; color: #999;">–ö–û–†–ó–ò–ù–ê –ü–£–°–¢–ê</div>';
                document.getElementById('cart-summary').style.display = 'none';
                return;
            }
            
            let html = '';
            cart.forEach((item, index) => {
                const typeLabel = item.type === 'catalog' ? 'üì¶ –¢–æ–≤–∞—Ä –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞' : 'üîç –°–≤–æ–±–æ–¥–Ω—ã–π –∑–∞–ø—Ä–æ—Å';
                
                html += `
                    <div class="cart-item">
                        <div class="cart-item-info">
                            <div class="cart-item-badge">${typeLabel}</div>
                            <div class="cart-item-title">${item.name}</div>
                            <div class="cart-item-details">
                                ${item.query ? `üîç ${item.query.substring(0, 40)}${item.query.length > 40 ? '...' : ''}\n` : ''}
                                ${item.size ? `üìè –†–∞–∑–º–µ—Ä: ${item.size}\n` : ''}
                                ${item.color ? `üé® –¶–≤–µ—Ç: ${item.color}\n` : ''}
                                ${item.notes ? `üìù ${item.notes.substring(0, 30)}${item.notes.length > 30 ? '...' : ''}\n` : ''}
                                ${item.photos && item.photos.length ? `üì∏ –§–æ—Ç–æ: ${item.photos.length} —à—Ç.` : ''}
                            </div>
                        </div>
                        <button class="cart-item-remove" onclick="removeFromCart(${index})">√ó</button>
                    </div>
                `;
            });
            
            document.getElementById('cart-items').innerHTML = html;
            document.getElementById('cart-total').textContent = cart.length;
            document.getElementById('cart-summary').style.display = 'block';
        }

        window.removeFromCart = function(index) {
            cart.splice(index, 1);
            localStorage.setItem('cart', JSON.stringify(cart));
            renderCart();
            renderCatalog();
            updateCartBadge();
        };

        function updateCartBadge() {
            document.getElementById('cart-badge').textContent = cart.length;
        }

        // ========== –û–§–û–†–ú–õ–ï–ù–ò–ï –ó–ê–ö–ê–ó–ê ==========
        window.submitOrder = async function() {
            if (cart.length === 0) {
                tg.showAlert('–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞');
                return;
            }
            
            const now = Date.now();
            if (now - lastOrderTime < SPAM_DELAY) {
                const remaining = Math.ceil((SPAM_DELAY - (now - lastOrderTime)) / 1000);
                tg.showAlert(`‚è≥ –ü–æ–¥–æ–∂–¥–∏—Ç–µ ${remaining} —Å–µ–∫.`);
                return;
            }
            
            const btn = document.getElementById('submit-order-btn');
            btn.disabled = true;
            btn.textContent = '–û–¢–ü–†–ê–í–ö–ê...';
            
            try {
                const orderData = {
                    userId: String(user.id),
                    userName: user.first_name || '–ì–æ—Å—Ç—å',
                    username: user.username || 'guest',
                    items: cart.map(item => ({
                        type: item.type,
                        name: item.name,
                        query: item.query || '',
                        size: item.size || '',
                        color: item.color || '',
                        notes: item.notes || '',
                        photos: item.photos || []
                    })),
                    totalItems: cart.length
                };
                
                let response = await fetch(API_URL + '/create-order', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(orderData)
                });
                
                let result = await response.json();
                
                if (result.success) {
                    lastOrderTime = Date.now();
                    
                    tg.showPopup({
                        title: '‚úÖ –ó–ê–ö–ê–ó –û–§–û–†–ú–õ–ï–ù',
                        message: `–ó–∞–∫–∞–∑ #${result.orderId}\n\n–ü–æ –≤–æ–ø—Ä–æ—Å–∞–º: @closersmanager`,
                        buttons: [
                            { type: 'default', text: '‚úâÔ∏è –ù–ê–ü–ò–°–ê–¢–¨ –ê–î–ú–ò–ù–£', url: ADMIN_CONTACT },
                            { type: 'ok', text: '–û–ö' }
                        ]
                    });
                    
                    cart = [];
                    localStorage.removeItem('cart');
                    renderCart();
                    renderCatalog();
                    updateCartBadge();
                    await loadOrders();
                    showView('orders');
                }
            } catch (error) {
                console.error(error);
                tg.showAlert('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º');
            } finally {
                btn.disabled = false;
                btn.textContent = '–û–§–û–†–ú–ò–¢–¨ –ó–ê–ö–ê–ó';
            }
        };

        // ========== –ó–ê–ì–†–£–ó–ö–ê –ó–ê–ö–ê–ó–û–í ==========
        async function loadOrders() {
            try {
                let response = await fetch(API_URL + '/user-orders?userId=' + user.id);
                let orders = await response.json();
                
                if (!orders || orders.length === 0) {
                    document.getElementById('orders-list').innerHTML = '<div style="text-align: center; padding: 40px; color: #999;">–£ –í–ê–° –ü–û–ö–ê –ù–ï–¢ –ó–ê–ö–ê–ó–û–í</div>';
                    return;
                }
                
                let html = '';
                orders.forEach(order => {
                    const statuses = [
                        { key: 'pending', label: '–û–∂–∏–¥–∞–Ω–∏–µ', date: order.date },
                        { key: 'searching', label: '–ü–æ–∏—Å–∫ –Ω–∞ POIZON', date: order.searchDate },
                        { key: 'ordered', label: '–ó–∞–∫–∞–∑–∞–Ω–æ —É –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞', date: order.orderedDate },
                        { key: 'shipping', label: '–í –ø—É—Ç–∏ –≤ –†–æ—Å—Å–∏—é', date: order.shippingDate },
                        { key: 'stock', label: '–ù–∞ —Å–∫–ª–∞–¥–µ', date: order.stockDate },
                        { key: 'delivery', label: '–ü–µ—Ä–µ–¥–∞–Ω–æ –≤ –¥–æ—Å—Ç–∞–≤–∫—É', date: order.deliveryDate },
                        { key: 'completed', label: '–ü–æ–ª—É—á–µ–Ω', date: order.completedDate }
                    ];
                    
                    const currentStatus = order.status || 'pending';
                    let currentIndex = statuses.findIndex(s => s.key === currentStatus);
                    if (currentIndex === -1) currentIndex = 0;
                    
                    html += `
                        <div class="order-card">
                            <div class="order-header">
                                <span class="order-id">–ó–ê–ö–ê–ó #${order.id}</span>
                                <span class="order-status-badge">${statuses[currentIndex].label}</span>
                            </div>
                            
                            <div class="status-timeline">
                                ${statuses.map((status, idx) => {
                                    let statusClass = '';
                                    if (idx < currentIndex) statusClass = 'completed';
                                    else if (idx === currentIndex) statusClass = 'active';
                                    
                                    return `
                                        <div class="status-step">
                                            <div class="status-dot ${statusClass}"></div>
                                            ${idx < statuses.length - 1 ? '<div class="status-line"></div>' : ''}
                                            <div class="status-content">
                                                <div class="status-title">${status.label}</div>
                                                ${status.date ? `<div class="status-date">${new Date(status.date).toLocaleString('ru-RU')}</div>` : ''}
                                            </div>
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                            
                            <div style="font-size: 12px; color: #999; margin-top: 12px;">
                                –¢–æ–≤–∞—Ä–æ–≤: ${order.items ? order.items.length : 1}
                            </div>
                        </div>
                    `;
                });
                
                document.getElementById('orders-list').innerHTML = html;
            } catch (error) {
                console.error(error);
                document.getElementById('orders-list').innerHTML = '<div style="text-align: center; padding: 40px; color: #999;">–û–®–ò–ë–ö–ê –ó–ê–ì–†–£–ó–ö–ò</div>';
            }
        }

        // ========== –ù–ê–í–ò–ì–ê–¶–ò–Ø (–¢–ï–ü–ï–†–¨ 4 –í–ö–õ–ê–î–ö–ò) ==========
        function showView(view) {
            document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
            document.getElementById('catalog-view').style.display = 'none';
            document.getElementById('cart-view').style.display = 'none';
            document.getElementById('orders-view').style.display = 'none';
            document.getElementById('faq-view').style.display = 'none';
            
            if (view === 'catalog') {
                document.querySelectorAll('.nav-item')[0].classList.add('active');
                document.getElementById('catalog-view').style.display = 'block';
                renderCatalog();
            } else if (view === 'cart') {
                document.querySelectorAll('.nav-item')[1].classList.add('active');
                document.getElementById('cart-view').style.display = 'block';
                renderCart();
            } else if (view === 'orders') {
                document.querySelectorAll('.nav-item')[2].classList.add('active');
                document.getElementById('orders-view').style.display = 'block';
                loadOrders();
            } else if (view === 'faq') {
                document.querySelectorAll('.nav-item')[3].classList.add('active');
                document.getElementById('faq-view').style.display = 'block';
            }
        }

        // ========== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ==========
        renderCatalog();
        updateCartBadge();
        loadOrders();
    </script>
</body>
</html>
