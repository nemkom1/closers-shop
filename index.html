<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CLOSERS | –ü–æ–∏—Å–∫ –∏ –∑–∞–∫–∞–∑ —Å POIZON</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
        }
        
        body {
            background-color: #1a1a1a;
            color: #ffffff;
            padding: 0 12px 80px 12px;
        }
        
        .app {
            max-width: 600px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 1px solid #333333;
        }
        
        .header h1 {
            font-size: 36px;
            font-weight: 700;
            letter-spacing: 1px;
            color: #ffffff;
            margin-bottom: 4px;
        }
        
        .subtitle {
            color: #999999;
            font-size: 14px;
            font-weight: 400;
            text-transform: uppercase;
            letter-spacing: 2px;
        }
        
        .vpn-notification {
            background-color: #2a2a2a;
            border-left: 4px solid #ffffff;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 20px;
            border: 1px solid #3a3a3a;
        }
        
        .vpn-content {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .vpn-icon {
            width: 40px;
            height: 40px;
            background-color: #ffffff;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #1a1a1a;
            font-size: 20px;
        }
        
        .vpn-text {
            flex: 1;
            font-size: 13px;
            color: #cccccc;
            line-height: 1.4;
        }
        
        .vpn-text strong {
            color: #ffffff;
            display: block;
            margin-bottom: 4px;
        }
        
        .vpn-close {
            background: none;
            border: none;
            color: #999;
            font-size: 20px;
            cursor: pointer;
            padding: 0 4px;
        }
        
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: #1a1a1a;
            border-top: 1px solid #333333;
            display: flex;
            justify-content: space-around;
            padding: 8px 16px 20px 16px;
            max-width: 600px;
            margin: 0 auto;
            z-index: 100;
        }
        
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            background: none;
            border: none;
            font-size: 11px;
            color: #999999;
            cursor: pointer;
            padding: 4px 8px;
            border-radius: 8px;
            gap: 4px;
        }
        
        .nav-item.active {
            color: #ffffff;
            font-weight: 500;
        }
        
        .nav-icon {
            font-size: 22px;
        }
        
        #cart-badge {
            background-color: #ffffff;
            color: #1a1a1a;
            border-radius: 20px;
            padding: 2px 6px;
            font-size: 10px;
            margin-left: 2px;
            font-weight: 600;
        }
        
        .floating-request-btn {
            position: fixed;
            bottom: 80px;
            right: 16px;
            z-index: 99;
            background-color: #ffffff;
            color: #1a1a1a;
            border: none;
            border-radius: 30px;
            padding: 12px 20px;
            font-weight: 600;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .floating-request-btn:hover {
            transform: scale(1.05);
            background-color: #f0f0f0;
        }

        @media (max-width: 480px) {
            .floating-request-btn {
                bottom: 80px;
                right: 8px;
                padding: 10px 16px;
                font-size: 13px;
            }
        }

        .quick-request-banner {
            background: linear-gradient(145deg, #2a2a2a, #222222);
            border-radius: 16px;
            padding: 16px;
            margin-bottom: 20px;
            border: 1px solid #3a3a3a;
        }

        .quick-request-content {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .quick-request-icon {
            width: 40px;
            height: 40px;
            background-color: #ffffff;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .quick-request-text {
            flex: 1;
        }

        .quick-request-title {
            font-weight: 600;
            margin-bottom: 4px;
            color: #ffffff;
        }

        .quick-request-subtitle {
            font-size: 12px;
            color: #999;
        }

        .quick-request-button {
            background-color: #ffffff;
            color: #1a1a1a;
            border: none;
            border-radius: 20px;
            padding: 8px 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .quick-request-button:hover {
            background-color: #f0f0f0;
        }
        
        /* ========== –ö–ê–¢–ï–ì–û–†–ò–ò ========== */
        .category-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
            overflow-x: auto;
            padding: 4px 0;
            -webkit-overflow-scrolling: touch;
        }
        
        .category-tab {
            background-color: #2a2a2a;
            border: 1px solid #3a3a3a;
            border-radius: 30px;
            padding: 8px 16px;
            font-size: 13px;
            color: #cccccc;
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.2s;
        }
        
        .category-tab.active {
            background-color: #ffffff;
            color: #1a1a1a;
            border-color: #ffffff;
        }
        
        .category-tab:hover {
            border-color: #ffffff;
        }
        
        .section-title {
            font-size: 18px;
            font-weight: 600;
            margin: 20px 0 12px 0;
            color: #ffffff;
        }
        
        .catalog-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-bottom: 24px;
        }
        
        .product-card {
            background-color: #2a2a2a;
            border-radius: 12px;
            padding: 8px;
            cursor: pointer;
            transition: all 0.2s;
            border: 1px solid #3a3a3a;
            position: relative;
        }
        
        .product-card:hover {
            transform: translateY(-2px);
            border-color: #ffffff;
        }
        
        .product-card.in-cart {
            border-color: #ffffff;
            background-color: #333333;
        }
        
        .product-image {
            width: 100%;
            aspect-ratio: 1/1;
            background-color: #3a3a3a;
            border-radius: 8px;
            margin-bottom: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #999999;
            font-size: 10px;
            font-weight: 500;
        }
        
        .product-title {
            font-size: 11px;
            font-weight: 500;
            margin-bottom: 2px;
            line-height: 1.2;
            height: 26px;
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            color: #ffffff;
        }
        
        .product-price {
            font-size: 12px;
            font-weight: 600;
            color: #ffffff;
        }
        
        .cart-badge-mini {
            position: absolute;
            top: 4px;
            right: 4px;
            background-color: #ffffff;
            color: #1a1a1a;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            font-size: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        
        .divider {
            display: flex;
            align-items: center;
            text-align: center;
            margin: 24px 0;
            color: #999999;
            font-size: 12px;
        }
        
        .divider::before,
        .divider::after {
            content: '';
            flex: 1;
            border-bottom: 1px solid #333333;
        }
        
        .divider::before {
            margin-right: 12px;
        }
        
        .divider::after {
            margin-left: 12px;
        }
        
        .support-section {
            background-color: #2a2a2a;
            border-radius: 16px;
            padding: 20px;
            margin-top: 16px;
            border: 1px solid #3a3a3a;
        }
        
        .support-header {
            text-align: center;
            margin-bottom: 24px;
        }
        
        .support-header h2 {
            font-size: 22px;
            font-weight: 600;
            margin-bottom: 8px;
            color: #ffffff;
        }
        
        .support-header p {
            color: #999999;
            font-size: 14px;
        }
        
        .admin-card {
            background: linear-gradient(145deg, #1a1a1a, #222222);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 24px;
            display: flex;
            align-items: center;
            gap: 16px;
            border: 1px solid #3a3a3a;
        }
        
        .admin-avatar {
            width: 60px;
            height: 60px;
            background-color: #ffffff;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
        }
        
        .admin-info {
            flex: 1;
        }
        
        .admin-name {
            font-weight: 600;
            font-size: 18px;
            margin-bottom: 4px;
            color: #ffffff;
        }
        
        .admin-username {
            color: #999999;
            font-size: 14px;
            margin-bottom: 8px;
        }
        
        .admin-chat-btn {
            background-color: #ffffff;
            color: #1a1a1a;
            border: none;
            border-radius: 30px;
            padding: 8px 20px;
            font-weight: 500;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            transition: all 0.2s;
        }
        
        .admin-chat-btn:hover {
            background-color: #e0e0e0;
            transform: scale(1.02);
        }
        
        .faq-grid {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }
        
        .faq-item {
            background-color: #1a1a1a;
            border-radius: 12px;
            padding: 16px;
            border: 1px solid #3a3a3a;
        }
        
        .faq-question {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 8px;
        }
        
        .faq-icon {
            width: 32px;
            height: 32px;
            background-color: #2a2a2a;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }
        
        .faq-question-text {
            font-weight: 600;
            font-size: 15px;
            color: #ffffff;
        }
        
        .faq-answer {
            padding-left: 44px;
            color: #cccccc;
            font-size: 13px;
            line-height: 1.5;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0,0,0,0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 16px;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background-color: #2a2a2a;
            border-radius: 20px;
            padding: 20px;
            width: 100%;
            max-width: 400px;
            max-height: 80vh;
            overflow-y: auto;
            border: 1px solid #3a3a3a;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }
        
        .modal-title {
            font-size: 18px;
            font-weight: 600;
            color: #ffffff;
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #999999;
        }
        
        .modal-product-preview {
            margin-bottom: 16px;
            padding: 12px;
            background-color: #1a1a1a;
            border-radius: 12px;
        }
        
        .modal-product-name {
            font-weight: 600;
            margin-bottom: 4px;
            color: #ffffff;
        }
        
        .modal-product-price {
            color: #999999;
            font-size: 14px;
        }
        
        .form-group {
            margin-bottom: 16px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-size: 12px;
            font-weight: 500;
            color: #999999;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #3a3a3a;
            border-radius: 8px;
            background-color: #1a1a1a;
            color: #ffffff;
            font-size: 14px;
        }
        
        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #ffffff;
        }
        
        .form-group input::placeholder,
        .form-group textarea::placeholder {
            color: #666666;
        }
        
        select option {
            background-color: #1a1a1a;
            color: #ffffff;
        }
        
        .photo-upload-area {
            border: 1px dashed #3a3a3a;
            border-radius: 12px;
            padding: 16px;
            text-align: center;
            margin-bottom: 12px;
            cursor: pointer;
            background-color: #1a1a1a;
        }
        
        .photo-upload-area:hover {
            border-color: #ffffff;
        }
        
        .photo-preview-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 8px;
            margin: 12px 0;
        }
        
        .photo-preview-item {
            position: relative;
            aspect-ratio: 1/1;
            border-radius: 8px;
            overflow: hidden;
            border: 1px solid #3a3a3a;
        }
        
        .photo-preview-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .photo-remove {
            position: absolute;
            top: 2px;
            right: 2px;
            background-color: rgba(0,0,0,0.7);
            color: white;
            border: none;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }
        
        /* ========== –ü–†–û–ú–û–ö–û–î–´ ========== */
        .promo-section {
            background-color: #1a1a1a;
            border-radius: 12px;
            padding: 16px;
            margin: 16px 0;
            border: 1px solid #3a3a3a;
        }
        
        .promo-input-group {
            display: flex;
            gap: 8px;
        }
        
        .promo-input-group input {
            flex: 1;
            padding: 12px;
            border: 1px solid #3a3a3a;
            border-radius: 8px;
            background-color: #2a2a2a;
            color: #ffffff;
            font-size: 14px;
        }
        
        .promo-input-group button {
            padding: 12px 20px;
            background-color: #ffffff;
            color: #1a1a1a;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
        }
        
        .promo-success {
            color: #4caf50;
            font-size: 13px;
            margin-top: 8px;
        }
        
        .promo-error {
            color: #f44336;
            font-size: 13px;
            margin-top: 8px;
        }
        
        .cart-container {
            background-color: #2a2a2a;
            border-radius: 16px;
            padding: 16px;
            margin-bottom: 16px;
            border: 1px solid #3a3a3a;
        }
        
        .cart-item {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            padding: 12px;
            background-color: #1a1a1a;
            border-radius: 12px;
            margin-bottom: 8px;
            border: 1px solid #3a3a3a;
        }
        
        .cart-item-info {
            flex: 1;
        }
        
        .cart-item-title {
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 4px;
            color: #ffffff;
        }
        
        .cart-item-details {
            font-size: 12px;
            color: #cccccc;
            white-space: pre-line;
        }
        
        .cart-item-badge {
            display: inline-block;
            padding: 2px 8px;
            background-color: #2a2a2a;
            border-radius: 12px;
            font-size: 10px;
            margin-bottom: 4px;
            color: #999999;
        }
        
        .cart-item-remove {
            background: none;
            border: none;
            color: #666666;
            font-size: 18px;
            cursor: pointer;
        }
        
        .btn {
            width: 100%;
            padding: 16px;
            background-color: #ffffff;
            color: #1a1a1a;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin-bottom: 8px;
            transition: all 0.2s;
        }
        
        .btn:hover {
            background-color: #e0e0e0;
        }
        
        .btn-secondary {
            background-color: #2a2a2a;
            color: #ffffff;
            border: 1px solid #3a3a3a;
        }
        
        .btn-secondary:hover {
            background-color: #333333;
        }
        
        .cart-summary {
            padding: 20px;
            background-color: #1a1a1a;
            border-radius: 12px;
            margin: 20px 0;
            border: 1px solid #3a3a3a;
            text-align: center;
        }
        
        .cart-summary p {
            font-size: 18px;
            font-weight: 600;
            color: #ffffff;
        }
        
        .orders-list {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }
        
        .order-card {
            background-color: #2a2a2a;
            border-radius: 16px;
            padding: 16px;
            border: 1px solid #3a3a3a;
        }
        
        .order-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .order-id {
            font-weight: 700;
            font-size: 15px;
            color: #ffffff;
        }
        
        .order-status-badge {
            padding: 4px 8px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 500;
            background-color: #1a1a1a;
            color: #cccccc;
        }
        
        .status-timeline {
            margin: 16px 0;
        }
        
        .status-step {
            display: flex;
            align-items: flex-start;
            margin-bottom: 12px;
            position: relative;
        }
        
        .status-dot {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background-color: #3a3a3a;
            margin-right: 12px;
            flex-shrink: 0;
            position: relative;
            z-index: 2;
        }
        
        .status-dot.completed {
            background-color: #ffffff;
        }
        
        .status-dot.active {
            background-color: #ffffff;
            box-shadow: 0 0 0 3px rgba(255,255,255,0.2);
        }
        
        .status-line {
            position: absolute;
            left: 9px;
            top: 20px;
            width: 2px;
            height: calc(100% - 8px);
            background-color: #3a3a3a;
            z-index: 1;
        }
        
        .status-content {
            flex: 1;
            padding-bottom: 12px;
        }
        
        .status-title {
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 2px;
            color: #ffffff;
        }
        
        .status-date {
            font-size: 11px;
            color: #999999;
        }
        
        .loading {
            text-align: center;
            color: #999999;
            padding: 40px;
        }
    </style>
</head>
<body>
    <div class="app">
        <header class="header">
            <h1>CLOSERS</h1>
            <div class="subtitle">–ü–û–ò–°–ö –ò –ó–ê–ö–ê–ó –° POIZON</div>
        </header>

        <div id="vpn-notification" class="vpn-notification">
            <div class="vpn-content">
                <div class="vpn-icon">üõ°Ô∏è</div>
                <div class="vpn-text">
                    <strong>–î–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã</strong>
                    –ï—Å–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –≤–∫–ª—é—á–∏—Ç—å VPN.
                </div>
                <button class="vpn-close" onclick="this.parentElement.parentElement.style.display='none'">√ó</button>
            </div>
        </div>

        <div id="catalog-view">
            <div class="quick-request-banner">
                <div class="quick-request-content">
                    <div class="quick-request-icon">üîç</div>
                    <div class="quick-request-text">
                        <div class="quick-request-title">–ò—â–µ—Ç–µ —á—Ç–æ-—Ç–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ?</div>
                        <div class="quick-request-subtitle">–û—Ç–ø—Ä–∞–≤—å—Ç–µ –∑–∞–ø—Ä–æ—Å ‚Äî –º—ã –Ω–∞–π–¥–µ–º –Ω–∞ POIZON</div>
                    </div>
                    <button class="quick-request-button" onclick="showFreeRequestModal()">–ó–∞–ø—Ä–æ—Å–∏—Ç—å</button>
                </div>
            </div>
            
            <!-- –ö–ê–¢–ï–ì–û–†–ò–ò -->
            <div class="category-tabs">
                <div class="category-tab active" onclick="filterCategory('all')">–í—Å–µ</div>
                <div class="category-tab" onclick="filterCategory('shoes')">üëü –û–±—É–≤—å</div>
                <div class="category-tab" onclick="filterCategory('clothes')">üëï –û–¥–µ–∂–¥–∞</div>
                <div class="category-tab" onclick="filterCategory('perfume')">üëÉ –î—É—Ö–∏</div>
                <div class="category-tab" onclick="filterCategory('glasses')">üëì –û—á–∫–∏</div>
                <div class="category-tab" onclick="filterCategory('bags')">üëú –°—É–º–∫–∏</div>
            </div>
            
            <div class="section-title">–ü–æ–ø—É–ª—è—Ä–Ω–æ–µ</div>
            <div class="catalog-grid" id="catalog-grid"></div>
        </div>
        
        <div id="cart-view" style="display: none;">
            <div class="cart-container">
                <div class="section-title">–ö–æ—Ä–∑–∏–Ω–∞</div>
                <div id="cart-items"></div>
                
                <!-- –ü–†–û–ú–û–ö–û–î–´ -->
                <div class="promo-section">
                    <div style="font-weight: 600; margin-bottom: 12px;">üéüÔ∏è –ü—Ä–æ–º–æ–∫–æ–¥</div>
                    <div class="promo-input-group">
                        <input type="text" id="promo-code" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø—Ä–æ–º–æ–∫–æ–¥">
                        <button onclick="applyPromoCode()">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
                    </div>
                    <div id="promo-message" class="promo-error" style="display: none;"></div>
                </div>
                
                <div id="cart-summary" class="cart-summary" style="display: none;">
                    <p><span id="cart-total">0</span> –¢–û–í–ê–†–û–í</p>
                    <div id="discount-info" style="font-size: 14px; color: #4caf50; margin-top: 8px; display: none;"></div>
                </div>
                <button class="btn" onclick="submitOrder()" id="submit-order-btn">–û–§–û–†–ú–ò–¢–¨ –ó–ê–ö–ê–ó</button>
            </div>
        </div>
        
        <div id="orders-view" style="display: none;">
            <div class="section-title">–ú–æ–∏ –∑–∞–∫–∞–∑—ã</div>
            <div id="orders-list" class="orders-list"></div>
        </div>
        
        <div id="support-view" style="display: none;">
            <div class="support-section">
                <div class="support-header">
                    <h2>–ü–æ–¥–¥–µ—Ä–∂–∫–∞</h2>
                    <p>–ú—ã –≤—Å–µ–≥–¥–∞ –Ω–∞ —Å–≤—è–∑–∏ –∏ –≥–æ—Ç–æ–≤—ã –ø–æ–º–æ—á—å</p>
                </div>
                
                <div class="admin-card">
                    <div class="admin-avatar">üë§</div>
                    <div class="admin-info">
                        <div class="admin-name">closersmanager</div>
                        <div class="admin-username">@closersmanager</div>
                        <button class="admin-chat-btn" onclick="window.open('https://t.me/closersmanager', '_blank')">
                            <span>üí¨</span> –ù–∞–ø–∏—Å–∞—Ç—å –∞–¥–º–∏–Ω—É
                        </button>
                    </div>
                </div>
                
                <div style="margin-top: 24px;">
                    <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 16px;">–ß–∞—Å—Ç–æ –∑–∞–¥–∞–≤–∞–µ–º—ã–µ –≤–æ–ø—Ä–æ—Å—ã</h3>
                    
                    <div class="faq-grid">
                        <div class="faq-item">
                            <div class="faq-question">
                                <div class="faq-icon">‚è±Ô∏è</div>
                                <div class="faq-question-text">–°–∫–æ–ª—å–∫–æ –∂–¥–∞—Ç—å –¥–æ—Å—Ç–∞–≤–∫—É?</div>
                            </div>
                            <div class="faq-answer">–û–±—ã—á–Ω–æ –¥–æ—Å—Ç–∞–≤–∫–∞ –∑–∞–Ω–∏–º–∞–µ—Ç –¥–æ 5 –¥–Ω–µ–π —Å –º–æ–º–µ–Ω—Ç–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞.</div>
                        </div>
                        
                        <div class="faq-item">
                            <div class="faq-question">
                                <div class="faq-icon">üí∞</div>
                                <div class="faq-question-text">–ö–∞–∫ —É–∑–Ω–∞—Ç—å —Ü–µ–Ω—É?</div>
                            </div>
                            <div class="faq-answer">–ü–æ—Å–ª–µ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –ø—Ä–æ–≤–µ—Ä–∏—Ç —Ü–µ–Ω—É –Ω–∞ POIZON –∏ —Å–æ–æ–±—â–∏—Ç –∏—Ç–æ–≥–æ–≤—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å.</div>
                        </div>
                        
                        <div class="faq-item">
                            <div class="faq-question">
                                <div class="faq-icon">üîÑ</div>
                                <div class="faq-question-text">–ú–æ–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å —Ç–æ–≤–∞—Ä?</div>
                            </div>
                            <div class="faq-answer">–í–æ–∑–≤—Ä–∞—Ç –≤–æ–∑–º–æ–∂–µ–Ω —Ç–æ–ª—å–∫–æ –≤ —Å–ª—É—á–∞–µ –±—Ä–∞–∫–∞. –ü–æ –≤—Å–µ–º –≤–æ–ø—Ä–æ—Å–∞–º –ø–∏—à–∏—Ç–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É.</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="product-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title">–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É</div>
                    <button class="modal-close" onclick="closeModal()">√ó</button>
                </div>
                
                <div id="modal-product" class="modal-product-preview"></div>
                
                <div class="form-group">
                    <label>–†–ê–ó–ú–ï–† (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
                    <select id="modal-size">
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–∑–º–µ—Ä</option>
                        <option value="XS">XS</option>
                        <option value="S">S</option>
                        <option value="M">M</option>
                        <option value="L">L</option>
                        <option value="XL">XL</option>
                        <option value="XXL">XXL</option>
                        <option value="36">36 EU</option>
                        <option value="37">37 EU</option>
                        <option value="38">38 EU</option>
                        <option value="39">39 EU</option>
                        <option value="40">40 EU</option>
                        <option value="41">41 EU</option>
                        <option value="42">42 EU</option>
                        <option value="43">43 EU</option>
                        <option value="44">44 EU</option>
                        <option value="45">45 EU</option>
                        <option value="46">46 EU</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>–¶–í–ï–¢ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
                    <input type="text" id="modal-color" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: Black/White">
                </div>
                
                <div class="form-group">
                    <label>–ü–û–ñ–ï–õ–ê–ù–ò–Ø (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
                    <textarea id="modal-notes" rows="2" placeholder="–û—Å–æ–±—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è..."></textarea>
                </div>
                
                <button class="btn" onclick="addToCartFromModal()">–î–û–ë–ê–í–ò–¢–¨ –í –ö–û–†–ó–ò–ù–£</button>
            </div>
        </div>

        <div id="free-request-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title">–°–≤–æ–±–æ–¥–Ω—ã–π –∑–∞–ø—Ä–æ—Å</div>
                    <button class="modal-close" onclick="closeFreeRequestModal()">√ó</button>
                </div>
                
                <div style="background-color: #1a1a1a; border-radius: 8px; padding: 12px; margin-bottom: 20px; color: #cccccc; font-size: 13px;">
                    –ú—ã –Ω–∞–π–¥–µ–º –∏ –ø—Ä–∏–≤–µ–∑–µ–º –ª—é–±–æ–π —Ç–æ–≤–∞—Ä —Å POIZON
                </div>
                
                <div class="form-group">
                    <label>–ß–¢–û –ò–©–ï–¢–ï? *</label>
                    <input type="text" id="modal-free-query" placeholder="–°—Å—ã–ª–∫–∞, –∞—Ä—Ç–∏–∫—É–ª –∏–ª–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞">
                </div>
                
                <div class="form-group">
                    <label>–†–ê–ó–ú–ï–† (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
                    <select id="modal-free-size">
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–∑–º–µ—Ä</option>
                        <option value="XS">XS</option>
                        <option value="S">S</option>
                        <option value="M">M</option>
                        <option value="L">L</option>
                        <option value="XL">XL</option>
                        <option value="XXL">XXL</option>
                        <option value="36">36 EU</option>
                        <option value="37">37 EU</option>
                        <option value="38">38 EU</option>
                        <option value="39">39 EU</option>
                        <option value="40">40 EU</option>
                        <option value="41">41 EU</option>
                        <option value="42">42 EU</option>
                        <option value="43">43 EU</option>
                        <option value="44">44 EU</option>
                        <option value="45">45 EU</option>
                        <option value="46">46 EU</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>–¶–í–ï–¢ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
                    <input type="text" id="modal-free-color" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: Black/White">
                </div>
                
                <div class="form-group">
                    <label>–ü–û–ñ–ï–õ–ê–ù–ò–Ø (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
                    <textarea id="modal-free-notes" rows="2" placeholder="–û—Å–æ–±—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è, —Å–æ—Å—Ç–æ—è–Ω–∏–µ, –±—é–¥–∂–µ—Ç..."></textarea>
                </div>
                
                <div class="form-group">
                    <label>–§–û–¢–û (–¥–æ 5 —à—Ç, –Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
                    <div class="photo-upload-area" onclick="document.getElementById('modal-free-file-input').click()">
                        <span style="font-size: 24px;">üì∑</span>
                        <div style="font-size: 12px; color: #999;">–ù–∞–∂–º–∏—Ç–µ, —á—Ç–æ–±—ã –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ</div>
                    </div>
                    <input type="file" id="modal-free-file-input" accept="image/*" multiple style="display: none;" onchange="handleModalFreePhotos(event)">
                    <div id="modal-free-photo-preview" class="photo-preview-grid"></div>
                </div>
                
                <button class="btn" onclick="addFreeRequestFromModal()">‚ûï –û–¢–ü–†–ê–í–ò–¢–¨ –ó–ê–ü–†–û–°</button>
            </div>
        </div>
        
        <button class="floating-request-btn" onclick="showFreeRequestModal()">
            <span style="font-size: 18px;">üîç</span> –°–≤–æ–π –∑–∞–ø—Ä–æ—Å
        </button>
        
        <div class="bottom-nav">
            <button class="nav-item active" onclick="showView('catalog')">
                <span class="nav-icon">üõçÔ∏è</span>
                <span>–ö–∞—Ç–∞–ª–æ–≥</span>
            </button>
            <button class="nav-item" onclick="showView('cart')">
                <span class="nav-icon">üõí</span>
                <span>–ö–æ—Ä–∑–∏–Ω–∞ <span id="cart-badge">0</span></span>
            </button>
            <button class="nav-item" onclick="showView('orders')">
                <span class="nav-icon">üì¶</span>
                <span>–ó–∞–∫–∞–∑—ã</span>
            </button>
            <button class="nav-item" onclick="showView('support')">
                <span class="nav-icon">üí¨</span>
                <span>–ü–æ–¥–¥–µ—Ä–∂–∫–∞</span>
            </button>
        </div>
    </div>

    <script>
        let tg = window.Telegram.WebApp;
        tg.expand();
        
        let user = tg.initDataUnsafe?.user || { 
            id: Math.floor(Math.random() * 1000000), 
            first_name: '–ì–æ—Å—Ç—å',
            username: 'guest'
        };

        const API_URL = 'https://maxkom.pythonanywhere.com/api';
        const ADMIN_CONTACT = 'https://t.me/closersmanager';

        // –ü—Ä–æ–º–æ–∫–æ–¥—ã
        let appliedPromo = null;
        const VALID_PROMOS = {
            'CLOSERS10': { discount: 10, type: 'percent' },
            'FIRST5': { discount: 5, type: 'percent' },
            'FREESHIP': { discount: 500, type: 'fixed' }
        };

        // –ö–∞—Ç–µ–≥–æ—Ä–∏–∏
        let currentCategory = 'all';

        // ========== –ö–ê–¢–ê–õ–û–ì –° –ö–ê–¢–ï–ì–û–†–ò–Ø–ú–ò ==========
        const CATALOG = [
            { id: 1, name: 'Nike Air Jordan 1 High OG', price: '195$', image: 'AJ1', category: 'shoes' },
            { id: 2, name: 'Essentials Fear of God Hoodie', price: '110$', image: 'FOG', category: 'clothes' },
            { id: 3, name: 'Stussy 8 Ball Zip Hoodie', price: '145$', image: 'STUSSY', category: 'clothes' },
            { id: 4, name: 'New Balance 990v6 Grey', price: '200$', image: 'NB990', category: 'shoes' },
            { id: 5, name: 'Adidas Samba OG', price: '100$', image: 'SAMBA', category: 'shoes' },
            { id: 6, name: 'Supreme Box Logo Hoodie', price: '398$', image: 'SUPREME', category: 'clothes' },
            { id: 7, name: 'Creed Aventus', price: '250$', image: 'CREED', category: 'perfume' },
            { id: 8, name: 'Dior Sauvage', price: '120$', image: 'DIOR', category: 'perfume' },
            { id: 9, name: 'Ray-Ban Aviator', price: '180$', image: 'RAYBAN', category: 'glasses' },
            { id: 10, name: 'Oakley Holbrook', price: '150$', image: 'OAKLEY', category: 'glasses' },
            { id: 11, name: 'Louis Vuitton Neverfull', price: '1200$', image: 'LV', category: 'bags' },
            { id: 12, name: 'Gucci GG Marmont', price: '980$', image: 'GUCCI', category: 'bags' }
        ];

        let cart = JSON.parse(localStorage.getItem('cart')) || [];
        let modalFreePhotos = [];
        let currentModalProduct = null;
        let lastOrderTime = 0;
        const SPAM_DELAY = 30000;

        // ========== –§–ò–õ–¨–¢–†–ê–¶–ò–Ø –ü–û –ö–ê–¢–ï–ì–û–†–ò–Ø–ú ==========
        window.filterCategory = function(category) {
            currentCategory = category;
            document.querySelectorAll('.category-tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            renderCatalog();
        };

        function renderCatalog() {
            let filteredProducts = CATALOG;
            if (currentCategory !== 'all') {
                filteredProducts = CATALOG.filter(p => p.category === currentCategory);
            }
            
            let html = '';
            filteredProducts.forEach(product => {
                const inCart = cart.some(item => item.catalogId === product.id);
                const cartCount = cart.filter(item => item.catalogId === product.id).length;
                
                html += `
                    <div class="product-card ${inCart ? 'in-cart' : ''}" onclick="openProductModal(${product.id})">
                        <div class="product-image">${product.image}</div>
                        <div class="product-title">${product.name}</div>
                        <div class="product-price">${product.price}</div>
                        ${cartCount > 0 ? `<div class="cart-badge-mini">${cartCount}</div>` : ''}
                    </div>
                `;
            });
            
            if (filteredProducts.length === 0) {
                html = '<div style="grid-column: 1/-1; text-align: center; padding: 40px; color: #999;">–í —ç—Ç–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø–æ–∫–∞ –Ω–µ—Ç —Ç–æ–≤–∞—Ä–æ–≤</div>';
            }
            
            document.getElementById('catalog-grid').innerHTML = html;
        }

        // ========== –ü–†–û–ú–û–ö–û–î–´ ==========
        window.applyPromoCode = function() {
            const code = document.getElementById('promo-code').value.trim().toUpperCase();
            const messageDiv = document.getElementById('promo-message');
            
            if (!code) {
                messageDiv.style.display = 'block';
                messageDiv.className = 'promo-error';
                messageDiv.textContent = '–í–≤–µ–¥–∏—Ç–µ –ø—Ä–æ–º–æ–∫–æ–¥';
                return;
            }
            
            if (VALID_PROMOS[code]) {
                appliedPromo = {
                    code: code,
                    ...VALID_PROMOS[code]
                };
                messageDiv.style.display = 'block';
                messageDiv.className = 'promo-success';
                messageDiv.textContent = `‚úÖ –ü—Ä–æ–º–æ–∫–æ–¥ –ø—Ä–∏–º–µ–Ω–µ–Ω! –°–∫–∏–¥–∫–∞ ${VALID_PROMOS[code].type === 'percent' ? VALID_PROMOS[code].discount + '%' : VALID_PROMOS[code].discount + '‚ÇΩ'}`;
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å–∫–∏–¥–∫–µ –≤ –∫–æ—Ä–∑–∏–Ω–µ
                const discountInfo = document.getElementById('discount-info');
                discountInfo.style.display = 'block';
                discountInfo.textContent = `–°–∫–∏–¥–∫–∞ –ø–æ –ø—Ä–æ–º–æ–∫–æ–¥—É ${code}: ${VALID_PROMOS[code].type === 'percent' ? VALID_PROMOS[code].discount + '%' : VALID_PROMOS[code].discount + '‚ÇΩ'}`;
            } else {
                appliedPromo = null;
                messageDiv.style.display = 'block';
                messageDiv.className = 'promo-error';
                messageDiv.textContent = '‚ùå –ù–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ–º–æ–∫–æ–¥';
                document.getElementById('discount-info').style.display = 'none';
            }
        };

        // ========== –ú–û–î–ê–õ–ö–ê –î–õ–Ø –¢–û–í–ê–†–ê ==========
        window.openProductModal = function(productId) {
            const product = CATALOG.find(p => p.id === productId);
            if (!product) return;
            
            currentModalProduct = product;
            
            document.getElementById('modal-product').innerHTML = `
                <div class="modal-product-name">${product.name}</div>
                <div class="modal-product-price">${product.price}</div>
            `;
            
            document.getElementById('modal-size').value = '';
            document.getElementById('modal-color').value = '';
            document.getElementById('modal-notes').value = '';
            
            document.getElementById('product-modal').classList.add('active');
        };

        window.closeModal = function() {
            document.getElementById('product-modal').classList.remove('active');
            currentModalProduct = null;
        };

        window.addToCartFromModal = function() {
            if (!currentModalProduct) return;
            
            const size = document.getElementById('modal-size').value;
            const color = document.getElementById('modal-color').value;
            const notes = document.getElementById('modal-notes').value;
            
            cart.push({
                catalogId: currentModalProduct.id,
                type: 'catalog',
                name: currentModalProduct.name,
                price: currentModalProduct.price,
                size: size,
                color: color,
                notes: notes,
                addedAt: new Date().toISOString()
            });
            
            localStorage.setItem('cart', JSON.stringify(cart));
            renderCatalog();
            updateCartBadge();
            closeModal();
            tg.showAlert(`‚úÖ –¢–æ–≤–∞—Ä –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∫–æ—Ä–∑–∏–Ω—É`);
        };

        // ========== –°–í–û–ë–û–î–ù–´–ô –ó–ê–ü–†–û–° ==========
        window.showFreeRequestModal = function() {
            modalFreePhotos = [];
            document.getElementById('modal-free-query').value = '';
            document.getElementById('modal-free-size').value = '';
            document.getElementById('modal-free-color').value = '';
            document.getElementById('modal-free-notes').value = '';
            document.getElementById('modal-free-photo-preview').innerHTML = '';
            
            document.getElementById('free-request-modal').classList.add('active');
        };

        window.closeFreeRequestModal = function() {
            document.getElementById('free-request-modal').classList.remove('active');
            modalFreePhotos = [];
        };

        window.handleModalFreePhotos = function(event) {
            const files = Array.from(event.target.files);
            if (modalFreePhotos.length + files.length > 5) {
                tg.showAlert('–ú–æ–∂–Ω–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å –Ω–µ –±–æ–ª–µ–µ 5 —Ñ–æ—Ç–æ');
                return;
            }
            
            files.forEach(file => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    modalFreePhotos.push(e.target.result);
                    renderModalFreePhotoPreview();
                };
                reader.readAsDataURL(file);
            });
        };

        function renderModalFreePhotoPreview() {
            let html = '';
            modalFreePhotos.forEach((photo, index) => {
                html += `
                    <div class="photo-preview-item">
                        <img src="${photo}" alt="preview">
                        <button class="photo-remove" onclick="removeModalFreePhoto(${index})">√ó</button>
                    </div>
                `;
            });
            document.getElementById('modal-free-photo-preview').innerHTML = html;
        }

        window.removeModalFreePhoto = function(index) {
            modalFreePhotos.splice(index, 1);
            renderModalFreePhotoPreview();
        };

        window.addFreeRequestFromModal = function() {
            const query = document.getElementById('modal-free-query').value;
            const size = document.getElementById('modal-free-size').value;
            const color = document.getElementById('modal-free-color').value;
            const notes = document.getElementById('modal-free-notes').value;
            
            if (!query) {
                tg.showAlert('–í–≤–µ–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å');
                return;
            }
            
            cart.push({
                type: 'free',
                name: '–ó–∞–ø—Ä–æ—Å: ' + query.substring(0, 30),
                query: query,
                size: size,
                color: color,
                notes: notes,
                photos: modalFreePhotos.slice(),
                addedAt: new Date().toISOString()
            });
            
            localStorage.setItem('cart', JSON.stringify(cart));
            
            closeFreeRequestModal();
            updateCartBadge();
            tg.showAlert(`‚úÖ –ó–∞–ø—Ä–æ—Å –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∫–æ—Ä–∑–∏–Ω—É`);
            showView('cart');
        };

        // ========== –ö–û–†–ó–ò–ù–ê ==========
        function renderCart() {
            if (cart.length === 0) {
                document.getElementById('cart-items').innerHTML = '<div style="text-align: center; padding: 40px; color: #999;">–ö–û–†–ó–ò–ù–ê –ü–£–°–¢–ê</div>';
                document.getElementById('cart-summary').style.display = 'none';
                document.getElementById('discount-info').style.display = 'none';
                return;
            }
            
            let html = '';
            cart.forEach((item, index) => {
                const typeLabel = item.type === 'catalog' ? 'üì¶ –¢–æ–≤–∞—Ä –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞' : 'üîç –°–≤–æ–±–æ–¥–Ω—ã–π –∑–∞–ø—Ä–æ—Å';
                
                html += `
                    <div class="cart-item">
                        <div class="cart-item-info">
                            <div class="cart-item-badge">${typeLabel}</div>
                            <div class="cart-item-title">${item.name}</div>
                            <div class="cart-item-details">
                                ${item.query ? `üîç ${item.query.substring(0, 40)}${item.query.length > 40 ? '...' : ''}\n` : ''}
                                ${item.size ? `üìè –†–∞–∑–º–µ—Ä: ${item.size}\n` : ''}
                                ${item.color ? `üé® –¶–≤–µ—Ç: ${item.color}\n` : ''}
                                ${item.notes ? `üìù ${item.notes.substring(0, 30)}${item.notes.length > 30 ? '...' : ''}\n` : ''}
                                ${item.photos && item.photos.length ? `üì∏ –§–æ—Ç–æ: ${item.photos.length} —à—Ç.` : ''}
                            </div>
                        </div>
                        <button class="cart-item-remove" onclick="removeFromCart(${index})">√ó</button>
                    </div>
                `;
            });
            
            document.getElementById('cart-items').innerHTML = html;
            document.getElementById('cart-total').textContent = cart.length;
            document.getElementById('cart-summary').style.display = 'block';
        }

        window.removeFromCart = function(index) {
            cart.splice(index, 1);
            localStorage.setItem('cart', JSON.stringify(cart));
            renderCart();
            renderCatalog();
            updateCartBadge();
        };

        function updateCartBadge() {
            document.getElementById('cart-badge').textContent = cart.length;
        }

        // ========== –û–§–û–†–ú–õ–ï–ù–ò–ï –ó–ê–ö–ê–ó–ê ==========
        window.submitOrder = async function() {
            if (cart.length === 0) {
                tg.showAlert('–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞');
                return;
            }
            
            const now = Date.now();
            if (now - lastOrderTime < SPAM_DELAY) {
                const remaining = Math.ceil((SPAM_DELAY - (now - lastOrderTime)) / 1000);
                tg.showAlert(`‚è≥ –ü–æ–¥–æ–∂–¥–∏—Ç–µ ${remaining} —Å–µ–∫.`);
                return;
            }
            
            const btn = document.getElementById('submit-order-btn');
            btn.disabled = true;
            btn.textContent = '–û–¢–ü–†–ê–í–ö–ê...';
            
            try {
                const orderData = {
                    userId: String(user.id),
                    userName: user.first_name || '–ì–æ—Å—Ç—å',
                    username: user.username || 'guest',
                    items: cart.map(item => ({
                        type: item.type,
                        name: item.name,
                        query: item.query || '',
                        size: item.size || '',
                        color: item.color || '',
                        notes: item.notes || '',  // ‚Üê –¢–ï–ü–ï–†–¨ –ü–û–ñ–ï–õ–ê–ù–ò–Ø –ü–ï–†–ï–î–ê–Æ–¢–°–Ø!
                        photos: item.photos || []
                    })),
                    promoCode: appliedPromo ? appliedPromo.code : null,
                    totalItems: cart.length
                };
                
                console.log('üì§ –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–∫–∞–∑–∞ —Å –ø–æ–∂–µ–ª–∞–Ω–∏—è–º–∏:', orderData);
                
                let response = await fetch(API_URL + '/create-order', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(orderData)
                });
                
                let result = await response.json();
                
                if (result.success) {
                    lastOrderTime = Date.now();
                    
                    tg.showPopup({
                        title: '‚úÖ –ó–ê–ö–ê–ó –û–§–û–†–ú–õ–ï–ù',
                        message: `–ó–∞–∫–∞–∑ #${result.orderId}\n\n–ü–æ –≤–æ–ø—Ä–æ—Å–∞–º: @closersmanager`,
                        buttons: [
                            { type: 'default', text: '‚úâÔ∏è –ù–ê–ü–ò–°–ê–¢–¨ –ê–î–ú–ò–ù–£', url: ADMIN_CONTACT },
                            { type: 'ok', text: '–û–ö' }
                        ]
                    });
                    
                    cart = [];
                    appliedPromo = null;
                    localStorage.removeItem('cart');
                    renderCart();
                    renderCatalog();
                    updateCartBadge();
                    await loadOrders();
                    showView('orders');
                }
            } catch (error) {
                console.error(error);
                tg.showAlert('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º');
            } finally {
                btn.disabled = false;
                btn.textContent = '–û–§–û–†–ú–ò–¢–¨ –ó–ê–ö–ê–ó';
            }
        };

        // ========== –ó–ê–ì–†–£–ó–ö–ê –ó–ê–ö–ê–ó–û–í ==========
        async function loadOrders() {
            try {
                let response = await fetch(API_URL + '/user-orders?userId=' + user.id);
                let orders = await response.json();
                
                if (!orders || orders.length === 0) {
                    document.getElementById('orders-list').innerHTML = '<div style="text-align: center; padding: 40px; color: #999;">–£ –í–ê–° –ü–û–ö–ê –ù–ï–¢ –ó–ê–ö–ê–ó–û–í</div>';
                    return;
                }
                
                let html = '';
                orders.forEach(order => {
                    const statuses = [
                        { key: 'pending', label: '–û–∂–∏–¥–∞–Ω–∏–µ', date: order.date },
                        { key: 'searching', label: '–ü–æ–∏—Å–∫ –Ω–∞ POIZON', date: order.searchDate },
                        { key: 'ordered', label: '–ó–∞–∫–∞–∑–∞–Ω–æ —É –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞', date: order.orderedDate },
                        { key: 'shipping', label: '–í –ø—É—Ç–∏ –≤ –†–æ—Å—Å–∏—é', date: order.shippingDate },
                        { key: 'stock', label: '–ù–∞ —Å–∫–ª–∞–¥–µ', date: order.stockDate },
                        { key: 'delivery', label: '–ü–µ—Ä–µ–¥–∞–Ω–æ –≤ –¥–æ—Å—Ç–∞–≤–∫—É', date: order.deliveryDate },
                        { key: 'completed', label: '–ü–æ–ª—É—á–µ–Ω', date: order.completedDate }
                    ];
                    
                    const currentStatus = order.status || 'pending';
                    let currentIndex = statuses.findIndex(s => s.key === currentStatus);
                    if (currentIndex === -1) currentIndex = 0;
                    
                    html += `
                        <div class="order-card">
                            <div class="order-header">
                                <span class="order-id">–ó–ê–ö–ê–ó #${order.id}</span>
                                <span class="order-status-badge">${statuses[currentIndex].label}</span>
                            </div>
                            
                            <div class="status-timeline">
                                ${statuses.map((status, idx) => {
                                    let statusClass = '';
                                    if (idx < currentIndex) statusClass = 'completed';
                                    else if (idx === currentIndex) statusClass = 'active';
                                    
                                    return `
                                        <div class="status-step">
                                            <div class="status-dot ${statusClass}"></div>
                                            ${idx < statuses.length - 1 ? '<div class="status-line"></div>' : ''}
                                            <div class="status-content">
                                                <div class="status-title">${status.label}</div>
                                                ${status.date ? `<div class="status-date">${new Date(status.date).toLocaleString('ru-RU')}</div>` : ''}
                                            </div>
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                            
                            <div style="font-size: 12px; color: #999; margin-top: 12px;">
                                –¢–æ–≤–∞—Ä–æ–≤: ${order.items ? order.items.length : 1}
                                ${order.promoCode ? `\nüéüÔ∏è –ü—Ä–æ–º–æ–∫–æ–¥: ${order.promoCode}` : ''}
                            </div>
                        </div>
                    `;
                });
                
                document.getElementById('orders-list').innerHTML = html;
            } catch (error) {
                console.error(error);
                document.getElementById('orders-list').innerHTML = '<div style="text-align: center; padding: 40px; color: #999;">–û–®–ò–ë–ö–ê –ó–ê–ì–†–£–ó–ö–ò</div>';
            }
        }

        // ========== –ù–ê–í–ò–ì–ê–¶–ò–Ø ==========
        function showView(view) {
            document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
            document.getElementById('catalog-view').style.display = 'none';
            document.getElementById('cart-view').style.display = 'none';
            document.getElementById('orders-view').style.display = 'none';
            document.getElementById('support-view').style.display = 'none';
            
            if (view === 'catalog') {
                document.querySelectorAll('.nav-item')[0].classList.add('active');
                document.getElementById('catalog-view').style.display = 'block';
                renderCatalog();
            } else if (view === 'cart') {
                document.querySelectorAll('.nav-item')[1].classList.add('active');
                document.getElementById('cart-view').style.display = 'block';
                renderCart();
            } else if (view === 'orders') {
                document.querySelectorAll('.nav-item')[2].classList.add('active');
                document.getElementById('orders-view').style.display = 'block';
                loadOrders();
            } else if (view === 'support') {
                document.querySelectorAll('.nav-item')[3].classList.add('active');
                document.getElementById('support-view').style.display = 'block';
            }
        }

        // ========== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ==========
        renderCatalog();
        updateCartBadge();
        loadOrders();
    </script>
</body>
</html>
